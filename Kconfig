# Copyright (c) 2025 Nordic Semiconductor ASA
# SPDX-License-Identifier: Apache-2.0

# Project Kconfig root; sources Zephyr menu.
source "Kconfig.zephyr"

menu "DTM Configuration"
config SHELL_BACKEND_SERIAL_RS485_DE
	bool "Shell UART RS485 DE GPIO control (HIGH before TX, LOW after)"
	default n
	depends on SHELL_BACKEND_SERIAL && GPIO

config SHELL_RS485_DE_GPIO_PIN
	int "RS485 DE GPIO pin (e.g. 21 = P0.21)"
	default 21
	depends on SHELL_BACKEND_SERIAL_RS485_DE

config SHELL_RS485_DE_OFF_DELAY_MS
	int "Delay (ms) before DE goes LOW after TX"
	default 1
	range 0 10
	depends on SHELL_BACKEND_SERIAL_RS485_DE
	help
	  Wait for UART to finish shifting last byte(s). Increase if PuTTY shows missing chars.

config SHELL_RS485_DE_ON_DELAY_US
	int "Delay (us) after DE HIGH before first TX byte"
	default 250
	range 0 1000
	depends on SHELL_BACKEND_SERIAL_RS485_DE
	help
	  Wait for transceiver to drive before sending. Fixes "art:~$" -> "uart:~$".

config SHELL_RS485_DE_MAX_HIGH_MS
	int "Max time (ms) DE stays HIGH; force LOW after to allow RX (Enter)"
	default 10
	range 5 50
	depends on SHELL_BACKEND_SERIAL_RS485_DE
	help
	  Safety: force DE low after this time so device can receive (e.g. Enter key).

config DTM_RADIO_IRQ_PRIORITY
	int "Radio interrupt priority"
	range 0 5 if ZERO_LATENCY_IRQS
	range 0 6
	default 2
	help
	  Sets Radio interrupt priority.
	  Levels are from 0 (highest priority) to 6 (lowest priority)

config DTM_TIMER_IRQ_PRIORITY
	int "DTM timer interrupt priority"
	range 0 5 if ZERO_LATENCY_IRQS
	range 0 6
	default 3
	help
	  Sets DTM timer interrupt priority.
	  Levels are from 0 (highest priority) to 6 (lowest priority)

config ANOMALY_172_TIMER_IRQ_PRIORITY
	int "Anomaly 172 timer interrupt priority"
	depends on SOC_NRF52840
	range 0 5 if ZERO_LATENCY_IRQS
	range 0 6
	default 2
	help
	  Sets anomaly 172 timer interrupt priority.
	  Levels are from 0 (highest priority) to 6 (lowest priority)

config DTM_USB
	bool "DTM over USB CDC ACM class"
	depends on SOC_NRF5340_CPUNET && !DTM_TRANSPORT_HCI
	select EXPERIMENTAL
	help
	  Use USB instead of UART as the DTM interface. For nRF5340 the USB from application core
	  is used as communication interface.

config DTM_TRANSPORT_HCI
	bool "DTM over HCI UART [EXPERIMENTAL]"
	depends on SERIAL
	depends on NET_BUF
	select EXPERIMENTAL
	help
	  Use the HCI UART transport interface as the DTM transport layer.
	  This option is inherited from SB_CONFIG_DTM_TRANSPORT_HCI.

if DTM_TRANSPORT_HCI

config DTM_HCI_QUEUE_COUNT
	int "Count of HCI RX/TX queues"
	default 16
	help
	  Maximum depth of the HCI RX/TX queues.

config DTM_HCI_QUEUE_SIZE
	int "Size of HCI RX/TX queue buffer"
	default 1024
	help
	  Maximum size of the HCI RX/TX queue element.

config DTM_HCI_TX_THREAD_STACK_SIZE
	int "Stack size of TX thread"
	default 2048
	help
	  Stack size of the TX thread.

config DTM_HCI_TX_THREAD_PRIORITY
	int "TX thread priority"
	default 7
	help
	  Priority of the TX thread.

endif # DTM_TRANSPORT_HCI

config DTM_POWER_CONTROL_AUTOMATIC
	bool "Automatic power control"
	depends on FEM
	default y
	help
	  Set the SoC output power and the front-end module gain to achieve the TX output power
	  requested by user. If the exact value cannot be achieved, power is set to the closest
	  possible value. If this option is disabled, user can set the SoC output power and the
	  front-end module gain with the separate vendor specific commands.

config DTM_FAST_RAMP_UP
	bool "Enable radio fast ramp up mode"
	default y
	help
	  Do fast ramp up when starting the radio peripheral. This mode will significancy reduce
	  the ramp up time and makes it almost the same on all supported chips.

module = DTM_TRANSPORT
module-str = "DTM_transport"
source "${ZEPHYR_BASE}/subsys/logging/Kconfig.template.log_config"
endmenu

# RS485 DE (patch shell_uart.c; options here so prj.conf can set them)
menu "RS485 DE Configuration"
config SHELL_BACKEND_SERIAL_RS485_DE
	bool "Shell UART RS485 DE GPIO control (HIGH before TX, LOW after)"
	default n
	depends on SHELL_BACKEND_SERIAL && GPIO

config SHELL_RS485_DE_GPIO_PIN
	int "RS485 DE GPIO pin (e.g. 21 = P0.21)"
	default 21
	depends on SHELL_BACKEND_SERIAL_RS485_DE

config SHELL_RS485_DE_OFF_DELAY_MS
	int "Delay (ms) before DE goes LOW after TX"
	default 1
	range 0 10
	depends on SHELL_BACKEND_SERIAL_RS485_DE
	help
	  Wait for UART to finish shifting last byte(s). Increase if PuTTY shows missing chars.

config SHELL_RS485_DE_ON_DELAY_US
	int "Delay (us) after DE HIGH before first TX byte"
	default 250
	range 0 1000
	depends on SHELL_BACKEND_SERIAL_RS485_DE
	help
	  Wait for transceiver to drive before sending. Fixes "art:~$" -> "uart:~$".

config SHELL_RS485_DE_MAX_HIGH_MS
	int "Max time (ms) DE stays HIGH; force LOW after to allow RX (Enter)"
	default 10
	range 5 50
	depends on SHELL_BACKEND_SERIAL_RS485_DE
	help
	  Safety: force DE low after this time so device can receive (e.g. Enter key).
endmenu

menu "Radio Test Configuration"
config RADIO_TEST_USB
	bool "Radio Test shell over USB CDC ACM class"
	depends on SOC_NRF5340_CPUNET
	select EXPERIMENTAL
	help
	  Use USB instead of UART as the Radio Test shell transport.
	  For nRF5340 the USB from application core is used as communication interface.

config RADIO_TEST_POWER_CONTROL_AUTOMATIC
	bool "Automatic power control"
	depends on FEM
	default y
	help
	  Set SoC output power and front-end module gain to achieve Tx output power requested
	  by user. If the exact value cannot be achieved, power is set to closest value which does
	  not exceed the limits. If this option is disabled, user has to set SoC output power and
	  fem gain with separate commands.

config RADIO_TEST_RX_TIMEOUT
	int "RX packet reception timeout"
	default 10
	help
	  Specifies the time in seconds that the application waits for the first packet to be
	  received in RX mode when a specified number of packets are set to be received.
	  If the timeout is reached before the first packet is received, the radio will be disabled.
endmenu

menu "UWB Configuration"
config UWB_LOG_ENABLED
	bool "Enable UWB logging output"
	default n
	help
	  Enable UWB module logging output. If disabled, all UWB log messages will be suppressed.

config UWB_PRINTK_LOG
	bool "Use printk for UWB logging (instead of shell/logging subsystem)"
	default n
	depends on UWB_LOG_ENABLED
	help
	  If enabled, UWB logs will use printk() directly instead of shell_print() or Zephyr logging subsystem.
	  This is useful for debugging but may produce more verbose output.
endmenu

menu "Shell Configuration"
config SHELL_THREAD_PRIORITY
	int "Shell thread priority"
	default 0
	range -15 15
	help
	  Priority of the shell thread. Lower numbers indicate higher priority.
	  Default is 0 (normal priority). Use negative values for higher priority.
	  For cooperative threads, use K_PRIO_COOP() macro values (typically 0-15).
	  For preemptible threads, use K_PRIO_PREEMPT() macro values (typically -15 to -1).
endmenu